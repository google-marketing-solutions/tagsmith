<!--
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 -->

<!-- Tagsmith, Debugger, v1.0.0 -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20,400,0,0" />
<style>
.__tagsmith_debugger_icon {
  background: center no-repeat url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8' standalone='no'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg width='100%25' height='100%25' viewBox='0 0 512 512' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve' xmlns:serif='http://www.serif.com/' style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;'%3E%3Cg transform='matrix(0.707107,-0.707107,0.707107,0.707107,-135.505,226.533)'%3E%3Cpath id='base' d='M404,170.352C404,159.213 399.575,148.53 391.698,140.653C368.601,117.556 318.154,67.108 285.698,34.653C269.296,18.251 242.704,18.251 226.302,34.653C193.846,67.108 143.399,117.556 120.302,140.653C112.425,148.53 108,159.213 108,170.352C108,220.899 108,368.788 108,441.963C108,453.102 112.425,463.785 120.302,471.662C128.178,479.538 138.861,483.963 150,483.963C206.309,483.963 305.691,483.963 362,483.963C373.139,483.963 383.822,479.538 391.698,471.662C399.575,463.785 404,453.102 404,441.963C404,368.788 404,220.899 404,170.352ZM256,82C271.454,82 284,94.546 284,110C284,125.454 271.454,138 256,138C240.546,138 228,125.454 228,110C228,94.546 240.546,82 256,82Z' style='fill:rgb(132,64,191);'/%3E%3Cg id='flame' transform='matrix(0.994924,-1.11022e-16,1.66533e-16,0.841367,1.139,76.3033)'%3E%3Cpath d='M404.916,326.607C404.916,324.376 403.604,322.445 401.761,321.964C399.919,321.484 398.041,322.584 397.248,324.608C395.018,330.299 392.645,336.353 390.643,341.462C387.702,348.968 381.342,353.771 374.347,353.771C374.347,353.771 374.347,353.771 374.346,353.771C367.452,353.771 361.391,348.372 359.488,340.536C353.921,317.607 342.537,270.723 336.887,247.456C334.914,239.328 328.627,233.728 321.476,233.729C321.476,233.729 321.476,233.729 321.475,233.729C314.258,233.729 307.825,239.11 305.423,247.158C300.108,264.968 290.705,296.472 284.742,316.448C281.468,327.418 272.7,334.755 262.862,334.755C262.861,334.755 262.861,334.755 262.861,334.755C256.886,334.755 251.402,330.843 248.615,324.592C243.462,313.037 235.051,294.173 229.52,281.768C226.124,274.152 219.441,269.385 212.159,269.385L212.158,269.385C202.36,269.385 193.6,276.6 190.203,287.467C182.801,311.149 169.971,352.194 163.195,373.871C160.496,382.506 153.535,388.239 145.75,388.239C145.75,388.239 145.75,388.239 145.749,388.239C137.242,388.239 129.675,381.847 126.916,372.332C123.615,360.946 119.091,345.341 115.23,332.024C114.592,329.826 112.704,328.494 110.766,328.877C108.827,329.259 107.406,331.242 107.406,333.566C107.406,360.677 107.406,402.029 107.406,434.602C107.406,447.841 111.854,460.538 119.77,469.9C127.687,479.261 138.425,484.521 149.62,484.521C206.217,484.521 306.106,484.521 362.702,484.521C373.898,484.521 384.635,479.261 392.552,469.9C400.469,460.538 404.916,447.841 404.916,434.602C404.916,399.097 404.916,353.16 404.916,326.607Z' style='fill:rgb(255,197,0);'/%3E%3C/g%3E%3Cg id='s' transform='matrix(9.31357,9.31357,-9.31357,9.31357,-35.3035,-2917.97)'%3E%3Cpath d='M188.341,165.528C186.482,165.528 184.928,165.091 183.681,164.218C182.721,163.546 181.975,162.729 181.445,161.767C181.321,161.544 181.296,161.279 181.376,161.037C181.457,160.795 181.635,160.598 181.868,160.494C182.171,160.357 182.513,160.204 182.814,160.069C183.238,159.879 183.737,160.04 183.972,160.441C184.374,161.138 184.895,161.7 185.535,162.127C186.385,162.693 187.321,162.977 188.341,162.977C189.429,162.977 190.359,162.756 191.13,162.314C191.901,161.871 192.287,161.242 192.287,160.426C192.287,159.7 191.98,159.116 191.368,158.674C190.756,158.232 189.792,157.852 188.477,157.535L186.368,156.991C184.985,156.65 183.851,156.072 182.967,155.256C182.083,154.44 181.64,153.385 181.64,152.093C181.64,151.095 181.941,150.216 182.542,149.457C183.143,148.697 183.942,148.113 184.94,147.705C185.937,147.297 187.015,147.093 188.171,147.093C189.69,147.093 191.045,147.421 192.236,148.079C193.09,148.551 193.766,149.157 194.264,149.897C194.415,150.119 194.46,150.395 194.389,150.653C194.317,150.911 194.135,151.125 193.892,151.236C193.595,151.374 193.268,151.524 192.983,151.655C192.589,151.836 192.121,151.714 191.866,151.363C191.064,150.238 189.819,149.678 188.137,149.678C187.185,149.678 186.351,149.899 185.637,150.341C184.923,150.783 184.566,151.344 184.566,152.025C184.566,152.66 184.815,153.175 185.314,153.572C185.813,153.969 186.561,154.292 187.559,154.542L190.076,155.188C191.776,155.619 193.058,156.259 193.919,157.11C194.781,157.96 195.212,158.997 195.212,160.222C195.212,161.288 194.906,162.223 194.293,163.028C193.681,163.833 192.853,164.451 191.81,164.882C190.767,165.312 189.611,165.528 188.341,165.528Z' style='fill:white;fill-rule:nonzero;'/%3E%3Cpath d='M188.341,166.135C189.696,166.135 190.929,165.903 192.042,165.443C193.192,164.968 194.102,164.283 194.777,163.396C195.469,162.485 195.819,161.428 195.819,160.222C195.819,158.827 195.327,157.646 194.346,156.677C193.421,155.764 192.052,155.062 190.226,154.599C190.226,154.599 187.71,153.953 187.71,153.953C187.709,153.953 187.707,153.953 187.706,153.952C186.813,153.729 186.138,153.452 185.692,153.097C185.346,152.822 185.173,152.465 185.173,152.025C185.173,151.545 185.454,151.169 185.957,150.857C186.579,150.472 187.307,150.285 188.137,150.285C189.59,150.285 190.678,150.743 191.372,151.715C191.373,151.717 191.374,151.718 191.375,151.72C191.8,152.305 192.58,152.509 193.237,152.207C193.237,152.207 193.237,152.207 193.237,152.207C193.522,152.076 193.85,151.925 194.147,151.788C194.551,151.602 194.854,151.246 194.974,150.816C195.093,150.386 195.018,149.926 194.767,149.557C194.217,148.74 193.472,148.068 192.529,147.547C191.252,146.842 189.8,146.485 188.171,146.485C186.932,146.485 185.779,146.706 184.71,147.143C183.608,147.593 182.729,148.241 182.065,149.08C181.379,149.948 181.033,150.952 181.033,152.093C181.033,153.569 181.545,154.77 182.555,155.702C183.509,156.583 184.73,157.213 186.222,157.58C186.22,157.579 188.325,158.123 188.325,158.123C188.328,158.124 188.332,158.124 188.335,158.125C189.551,158.419 190.447,158.758 191.013,159.167C191.454,159.485 191.679,159.903 191.679,160.426C191.679,161.018 191.387,161.466 190.828,161.787C190.141,162.181 189.311,162.369 188.341,162.369C187.443,162.369 186.62,162.12 185.872,161.621C185.309,161.246 184.851,160.751 184.498,160.138C184.498,160.136 184.497,160.135 184.496,160.134C184.105,159.465 183.273,159.198 182.566,159.515C182.566,159.515 182.566,159.515 182.566,159.515C182.265,159.649 181.922,159.803 181.618,159.94C181.231,160.114 180.934,160.443 180.8,160.846C180.666,161.249 180.707,161.69 180.914,162.061C181.488,163.102 182.293,163.988 183.333,164.716C184.674,165.655 186.341,166.135 188.341,166.135ZM188.341,165.528C186.482,165.528 184.928,165.091 183.681,164.218C182.721,163.546 181.975,162.729 181.445,161.767C181.321,161.544 181.296,161.279 181.376,161.037C181.457,160.795 181.635,160.598 181.868,160.494C182.171,160.357 182.513,160.204 182.814,160.069C183.238,159.879 183.737,160.04 183.972,160.441C184.374,161.138 184.895,161.7 185.535,162.127C186.385,162.693 187.321,162.977 188.341,162.977C189.429,162.977 190.359,162.756 191.13,162.314C191.901,161.871 192.287,161.242 192.287,160.426C192.287,159.7 191.98,159.116 191.368,158.674C190.756,158.232 189.792,157.852 188.477,157.535L186.368,156.991C184.985,156.65 183.851,156.072 182.967,155.256C182.083,154.44 181.64,153.385 181.64,152.093C181.64,151.095 181.941,150.216 182.542,149.457C183.143,148.697 183.942,148.113 184.94,147.705C185.937,147.297 187.015,147.093 188.171,147.093C189.69,147.093 191.045,147.421 192.236,148.079C193.09,148.551 193.766,149.157 194.264,149.897C194.415,150.119 194.46,150.395 194.389,150.653C194.317,150.911 194.135,151.125 193.892,151.236C193.595,151.374 193.268,151.524 192.983,151.655C192.589,151.836 192.121,151.714 191.866,151.363C191.064,150.238 189.819,149.678 188.137,149.678C187.185,149.678 186.351,149.899 185.637,150.341C184.923,150.783 184.566,151.344 184.566,152.025C184.566,152.66 184.815,153.175 185.314,153.572C185.813,153.969 186.561,154.292 187.559,154.542L190.076,155.188C191.776,155.619 193.058,156.259 193.919,157.11C194.781,157.96 195.212,158.997 195.212,160.222C195.212,161.288 194.906,162.223 194.293,163.028C193.681,163.833 192.853,164.451 191.81,164.882C190.767,165.312 189.611,165.528 188.341,165.528Z' style='fill:rgb(132,64,191);'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E%0A");
}

.__tagsmith_debugger_open {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 50px;
  height: 50px;
  box-sizing: border-box;
  background-size: 32px;
  background-color: #F1F3F4;
  border-radius: 50%;
  box-shadow:
    rgba(0, 0, 0, 0.2) 0px 3px 5px -1px,
    rgba(0, 0, 0, 0.14) 0px 5px 8px 0px,
    rgba(0, 0, 0, 0.12) 0px 1px 14px 0px;
  z-index: 2147483648;
  cursor: pointer;
}

.__tagsmith_debugger_open:hover {
  background-color: #FEF7E0;
}

.__tagsmith_debugger_container {
  position: fixed;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  z-index: 2147483648;
  background: rgba(0, 0, 0, 0.5);
  padding: 20px;
  display: none;
  align-items: center;
  justify-content: center;
}

.__tagsmith_debugger_popup {
  overflow: hidden;
  display: flex;
  flex-direction: column;
  font-family: Helvetica Neue,Helvetica,Arial,sans-serif;
  font-size: 10px;
  line-height: 1.3;
  min-width: 335px;
  max-height: 100%;
  background: #FFF;
  border-radius: 8px;
  box-shadow:
    rgba(0, 0, 0, 0.2) 0px 3px 5px -1px,
    rgba(0, 0, 0, 0.14) 0px 5px 8px 0px,
    rgba(0, 0, 0, 0.12) 0px 1px 14px 0px;
}

.__tagsmith_debugger_header {
  flex: 0 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 12px;
  font-size: 1.4em;
  font-weight: bold;
  color: #202124;
  background: #F1F3F4;
}

.__tagsmith_debugger_header .__tagsmith_debugger_icon {
  width: 32px;
  height: 32px;
}

.__tagsmith_debugger_actions {
  display: flex;
}

.__tagsmith_debugger_action_item {
  font-family: Material Symbols Outlined;
  font-size: 18px;
  text-align: center;
  line-height: 40px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
}

.__tagsmith_debugger_action_item:hover {
  background: #DADCE0;
}

.__tagsmith_debugger_more {
  position: relative;
}

.__tagsmith_debugger_menu {
  display: none;
  position: absolute;
  right: 0;
  top: 40px;
  overflow: hidden;
  background: #FFF;
  border-radius: 8px;
  box-shadow:
    rgba(0, 0, 0, 0.2) 0px 3px 5px -1px,
    rgba(0, 0, 0, 0.14) 0px 5px 8px 0px,
    rgba(0, 0, 0, 0.12) 0px 1px 14px 0px;
}

.__tagsmith_debugger_more:focus > .__tagsmith_debugger_menu {
  display: block;
}

.__tagsmith_debugger_menu_item {
  padding: 6px 12px;
  font-weight: normal;
  cursor: pointer;
  white-space: nowrap;
}

.__tagsmith_debugger_menu_item:hover {
  background: #FEF7E0;
}

.__tagsmith_debugger_body {
  overflow: auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 12px;
  font-size: 1.4em;
}

.__tagsmith_debugger_body > * {
  padding-bottom: 12px;
  border-bottom: #9AA0A6 1px dashed;
}

.__tagsmith_debugger_body > *:last-child {
  padding-bottom: none;
  border-bottom: none;
}

.__tagsmith_debugger_sectionTitle {
  padding: 6px 0;
  font-weight: bold;
}

#__tagsmith_debugger_errors {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.__tagsmith_debugger_error {
  display: flex;
  align-items: center;
  color: #D93025;
}

.__tagsmith_debugger_error::before {
  content: "error";
  margin-right: 6px;
  font-family: Material Symbols Outlined;
  font-size: 20px;
}

#__tagsmith_debugger_featuresForAll {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

#__tagsmith_debugger_featuresForAll > * {
  margin: 0;
}

.__tagsmith_debugger_table {
  flex-grow: 1;
  border-collapse: collapse;
}

.__tagsmith_debugger_table th,
.__tagsmith_debugger_table td {
  white-space: nowrap;
  padding: 6px 12px;
}

.__tagsmith_debugger_table td {
  border: #9AA0A6 1px solid;
}

.__tagsmith_debugger_testName {
  width: 64px;
  font-weight: bold;
  background: #E8EAED;
}

.__tagsmith_debugger_variant {
  position: relative;
  width: 64px;
  background: #F8F9FA;
}

.__tagsmith_debugger_variant:not(.active) {
  cursor: pointer;
}

.__tagsmith_debugger_variant::before {
  position: absolute;
  top: 0;
  right: 4px;
  font-family: Material Symbols Outlined;
  font-size: 24px;
}

.__tagsmith_debugger_variant::before {
  content: "toggle_off";
  color: #9AA0A6;
}

.__tagsmith_debugger_variant.active::before,
.__tagsmith_debugger_variant:hover::before {
  content: "toggle_on";
  color: #34A853;
}

.__tagsmith_debugger_percentage {
  display: block;
  width: min-content;
  margin-bottom: 3px;
  padding: 0 6px;
  border-radius: 50vh;
  font-weight: normal;
  background: #FFF;
  border: #9AA0A6 1px solid;
}

.__tagsmith_debugger_feature,
.__tagsmith_debugger_logger {
  display: inline-block;
  margin-right: 6px;
  padding: 6px 12px;
  border-radius: 50vh;
  color: #FFF;
}

.__tagsmith_debugger_feature:last-child,
.__tagsmith_debugger_logger:last-child {
  margin-right: 0;
}

.__tagsmith_debugger_feature {
  background: #34A853;
}

.__tagsmith_debugger_logger {
  background: #4285F4;
}
</style>
<div id="__tagsmith_debugger">
  <div class="__tagsmith_debugger_open __tagsmith_debugger_icon"></div>
  <div class="__tagsmith_debugger_container">
    <div class="__tagsmith_debugger_popup">
      <div class="__tagsmith_debugger_header">
        <div class="__tagsmith_debugger_icon"></div>
        Tagsmith Debugger
        <div class="__tagsmith_debugger_actions">
          <div tabindex="1" class="__tagsmith_debugger_more">
            <div class="__tagsmith_debugger_action_item">more_horiz</div>
            <div class="__tagsmith_debugger_menu">
              <div id="__tagsmith_debugger_test_setup" class="__tagsmith_debugger_menu_item">Test setup</div>
            </div>
          </div>
          <div class="__tagsmith_debugger_action_item __tagsmith_debugger_close">close</div>
        </div>
      </div>
      <div class="__tagsmith_debugger_body">
        <div>
          <div class="__tagsmith_debugger_sectionTitle">Errors</div>
          <div id="__tagsmith_debugger_errors"></div>
        </div>
        <div>
          <div class="__tagsmith_debugger_sectionTitle">Features enabled for all users</div>
          <div id="__tagsmith_debugger_featuresForAll"></div>
        </div>
        <table class="__tagsmith_debugger_table">
          <thead>
            <tr>
              <th>Test</th>
              <th>Variant</th>
              <th>Feature Enabled</th>
              <th>Loggers Enabled</th>
            </tr>
          </thead>
          <tbody id="__tagsmith_debugger_testStatus"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script>
(function(w, o) {
  var LOCAL_STORAGE_KEY = '__tagsmith_ab_factor';
  var DEBUG = w[o].__debug();

  var errors = [];

  /** @type {!Array<{
   *   name: string,
   *   percentage: number,
   *   variants: !Array<{
   *     name: string,
   *     percentage: number,
   *     leftBoundary: number
   *   }
   * }}
   */
  var abStatus = [];
  /** @type {!Array<string>} */
  var validVariants = [];

  for (var i = 0; i < DEBUG.AB_CONF.length; i++) {
    var testConf = DEBUG.AB_CONF[i];
    var lastTestConf = i === 0 ? null : DEBUG.AB_CONF[i - 1];

    var leftBoundary = lastTestConf ? lastTestConf[lastTestConf.length - 1] : 0;

    var test = {
      name: testConf[0],
      percentage: testConf[testConf.length - 1] - leftBoundary,
      variants: []
    };
    abStatus.push(test);

    for (var j = 1; j < testConf.length; j++) {
      var isControlVariant = j === 1;
      var rightBoundary = testConf[j];

      var variant = {
        name: test.name + '_' + (isControlVariant ? 'con' : 'exp' + (j - 1)),
        percentage: rightBoundary - leftBoundary,
        leftBoundary: leftBoundary
      };
      test.variants.push(variant);

      leftBoundary = rightBoundary;

      if (!isControlVariant) {
        validVariants.push(variant.name);
      }
    }
  }

  var featuresForAll = [];
  var featureByVariant = {};

  var originalEnableFunc = w[o].enable;
  /**
   * Try enabling a feature for a specific variant.
   * This debugger version provides the same feature as original but records
   * all features enabled and logs any potential errors.
   * @param {string} feature
   * @param {string} forVariant
   * @return {boolean} `true` if the feature should be enabled for current user.
   */
  w[o].enable = function(feature, forVariant) {
    if (forVariant === 'all') {
      featuresForAll.push(feature);
    } else if (validVariants.indexOf(forVariant) === -1) {
      errors.push(forVariant + ' is not valid.');
    } else if (featureByVariant[forVariant]) {
      errors.push(
          forVariant + ' already used by ' + featureByVariant[forVariant]
      );
    } else {
      featureByVariant[forVariant] = feature;
    }

    return originalEnableFunc(feature, forVariant);
  };

  /** @type {!Object<string, !Array<string>>} */
  var loggersEnabledByTest = {};

  var originalGetLoggerFunc = w[o].getLogger;

  /** @typedef {function(string, string): void} */
  // eslint-disable-next-line no-unused-vars
  var Logger;

  /**
   * Get logger for feature on a specific variant.
   * This debugger version provides the same feature as original but records
   * all features enabled and logs any potential errors.
   * @param {string} feature
   * @param {string} forVariant
   * @return {!Logger|false} `false` when logger shouldn't be enabled.
   */
  w[o].getLogger = function(feature, forVariant) {
    if (forVariant !== 'all') {
      var forTestName = forVariant.substr(0, forVariant.lastIndexOf('_'));
      loggersEnabledByTest[forTestName] =
        loggersEnabledByTest[forTestName] || [];
      if (loggersEnabledByTest[forTestName].indexOf(feature) === -1) {
        loggersEnabledByTest[forTestName].push(feature);
      }
    }

    return originalGetLoggerFunc(feature, forVariant);
  };

  /**
   * Assign current user to a specific variant.
   * @param {string} variant
   */
  var activateVariant = function(variant) {
    if (!confirm('Assign current user to variant "' + variant.name + '"?')) {
      return;
    }

    localStorage.setItem(LOCAL_STORAGE_KEY, variant.leftBoundary.toString());

    alert('Assigned. Refreshing pageâ€¦');
    window.location.reload();
  };

  // #region UI implementations

  var $root = document.getElementById('__tagsmith_debugger');
  var $open = $root.querySelector('.__tagsmith_debugger_open');
  var $container = $root.querySelector('.__tagsmith_debugger_container');
  var $testSetup = $root.querySelector('#__tagsmith_debugger_test_setup');
  var $close = $root.querySelector('.__tagsmith_debugger_close');

  var testSetupLogger;

  /**
   * Test framework setup.
   */
  var testSetup = function() {
    var userVariant = w[o].userVariant();

    if (!testSetupLogger) {
      testSetupLogger = w[o].getLogger('debugger', userVariant);
    }

    if (testSetupLogger) {
      var eventName = 'testEventName';
      var eventValue = 'testEventValue';
      testSetupLogger(eventName, eventValue);
      alert('Event sent with name: ' + eventName + ', value: ' + eventValue);
    } else {
      alert('Can\'t get logger for debugger.');
    }
  };

  $testSetup.addEventListener('click', testSetup);

  /**
   * Refresh all UI elements.
   */
  var refresh = function() {
    refreshErrors();
    refreshFeaturesForAll();
    refreshAbStatus();
  };

  var $errors = $root.querySelector('#__tagsmith_debugger_errors');

  /**
   * Refresh errors.
   */
  var refreshErrors = function() {
    $errors.innerText = '';

    if (errors.length === 0) {
      $errors.innerText = 'None';
      return;
    }

    for (var i = 0; i < errors.length; i++) {
      var error = errors[i];
      var $error = document.createElement('div');
      $error.className = '__tagsmith_debugger_error';
      $error.innerText = error;
      $errors.append($error);
    }
  };

  var $featuresForAll = $root.querySelector(
      '#__tagsmith_debugger_featuresForAll'
  );

  /**
   * Refresh features enabled for all users.
   */
  var refreshFeaturesForAll = function() {
    $featuresForAll.innerText = '';

    if (featuresForAll.length === 0) {
      $featuresForAll.innerText = 'None';
      return;
    }

    for (var i = 0; i < featuresForAll.length; i++) {
      var $feature = document.createElement('div');
      $feature.className = '__tagsmith_debugger_feature';
      $feature.innerText = featuresForAll[i];
      $featuresForAll.append($feature);
    }
  };

  var $testStatus = $root.querySelector('#__tagsmith_debugger_testStatus');

  /**
   * Refresh features and loggers enabled for each variant.
   */
  var refreshAbStatus = function() {
    var userVariant = w[o].userVariant();

    $testStatus.innerText = '';

    for (var i = 0; i < abStatus.length; i++) {
      var test = abStatus[i];

      var $testName = document.createElement('td');
      $testName.className = '__tagsmith_debugger_testName';
      $testName.rowSpan = test.variants.length;
      $testName.innerText = test.name;

      var $testPercentage = document.createElement('div');
      $testPercentage.className = '__tagsmith_debugger_percentage';
      $testPercentage.innerText = (test.percentage * 100).toFixed(2) + '%';
      $testName.prepend($testPercentage);

      for (var j = 0; j < test.variants.length; j++) {
        var variant = test.variants[j];

        var $tr = document.createElement('tr');
        $testStatus.append($tr);

        if (j === 0) {
          $tr.append($testName);
        }

        var $variant = document.createElement('td');
        $variant.className = '__tagsmith_debugger_variant';
        $variant.innerText = variant.name;
        $tr.append($variant);

        if (variant.name === userVariant) {
          $variant.classList.add('active');
        } else {
          $variant.addEventListener(
              'click',
              activateVariant.bind(null, variant)
          );
        }

        var $variantPercentage = document.createElement('div');
        $variantPercentage.className = '__tagsmith_debugger_percentage';
        $variantPercentage.innerText =
          (variant.percentage * 100).toFixed(2) + '%';
        $variant.prepend($variantPercentage);

        var $featureEnabled = document.createElement('td');
        $tr.append($featureEnabled);

        if (featureByVariant[variant.name]) {
          var $feature = document.createElement('div');
          $feature.className = '__tagsmith_debugger_feature';
          $feature.innerText = featureByVariant[variant.name];
          $featureEnabled.append($feature);
        }

        var $loggersEnabled = document.createElement('td');
        $tr.append($loggersEnabled);

        if (loggersEnabledByTest[test.name]) {
          var loggers = loggersEnabledByTest[test.name];

          for (var k = 0; k < loggers.length; k++) {
            var $logger = document.createElement('div');
            $logger.className = '__tagsmith_debugger_logger';
            $logger.innerText = loggers[k];
            $loggersEnabled.append($logger);
          }
        }
      }
    }
  };

  $open.addEventListener('click', function() {
    $container.style.display = 'flex';

    refresh();
  });

  $close.addEventListener('click', function() {
    $container.style.display = 'none';
  });

  // #endregion
})(window, '__tagsmith');
</script>
